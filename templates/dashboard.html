<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Hive</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toppanel.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    aria-hidden="true">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div class="mobile-brand">
                <img src="{{ url_for('static', filename='favicon.svg') }}" width="24" height="24" alt="Logo">
                <span class="brand-gradient" style="font-size: 1.2rem;">LogHive</span>
            </div>
            <div class="mobile-actions">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle-mobile" aria-label="Toggle theme">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="display: none;" aria-hidden="true">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" aria-hidden="true">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <div class="user-menu-container">
                    <button class="user-avatar" title="{{ current_user.username }}" onclick="toggleUserMenu(event)"
                        aria-label="User menu" aria-expanded="false">
                        {{ current_user.username[:2] }}
                    </button>

                    <div class="dropdown-menu">
                        <div class="dropdown-header">
                            <div class="dropdown-user-name">{{ current_user.username }}</div>
                            <div class="dropdown-user-role">{{ current_user.environment }}</div>
                        </div>
                        <a href="{{ url_for('logout') }}" class="dropdown-item text-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign out
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar Overlay (for mobile) -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="{{ url_for('static', filename='favicon.svg') }}" width="40" height="40" alt="Logo">
                </div>
                <span class="brand-name">LogHive</span>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="switchView('dashboard')">
                    <span class="nav-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            aria-hidden="true">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </span>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" onclick="switchView('log-search')">
                    <span class="nav-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            aria-hidden="true">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </span>
                    <span>Log Search Web</span>
                </button>

                <div class="sidebar-divider"></div>

                <button class="nav-item sidebar-collapse-btn" onclick="toggleSidebarCollapse()" title="展開/收起選單">
                    <span class="nav-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            aria-hidden="true">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </span>
                    <span>收起選單</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <!-- User info moved to top nav -->
                <!-- Logout removed -->
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Nav (Desktop) -->
            <div class="top-nav">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle-desktop"
                    aria-label="Toggle theme">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="display: none;" aria-hidden="true">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" aria-hidden="true">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <div class="user-menu-container">
                    <button class="user-profile" onclick="toggleUserMenu(event)" aria-label="User menu"
                        aria-expanded="false">
                        <div class="user-avatar">
                            {{ current_user.username[:2] }}
                        </div>
                        <div class="user-info-text">
                            <span class="user-name-text">{{ current_user.username }}</span>
                            <span class="user-role-text">{{ current_user.environment }}</span>
                        </div>
                    </button>

                    <div class="dropdown-menu">
                        <div class="dropdown-header">
                            <div class="dropdown-user-name">{{ current_user.username }}</div>
                            <div class="dropdown-user-role">{{ current_user.environment }}</div>
                        </div>
                        <!-- <div class="dropdown-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Profile
                        </div> -->
                        <a href="{{ url_for('logout') }}" class="dropdown-item text-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign out
                        </a>
                    </div>
                </div>
            </div>
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view-section active">
                <header class="view-header">
                    <div class="header-content">
                        <h1>站點監控總覽</h1>
                        <p>監控各站點資料夾大小與增長趨勢</p>
                    </div>
                    <div class="header-actions">
                        <button onclick="refreshData()" class="btn btn-glass btn-sm" title="重新載入資料">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path
                                    d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3" />
                            </svg>
                            <span>刷新</span>
                        </button>
                        {% if current_user.environment == 'test' %}
                        <button onclick="seedDemoData()" class="btn btn-glass-outline btn-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                            </svg>
                            載入測試數據
                        </button>
                        {% endif %}
                    </div>
                </header>

                <section class="stats-overview" id="stats-overview">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                                <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                                <line x1="6" y1="6" x2="6.01" y2="6"></line>
                                <line x1="6" y1="18" x2="6.01" y2="18"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="total-sites">-</span>
                            <span class="stat-label">監控站點</span>
                        </div>
                    </div>
                    <div class="stat-card site-siteb">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="siteb-size">-</span>
                            <span class="stat-label">Site_B 總容量</span>
                        </div>
                    </div>
                    <div class="stat-card site-sitea">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="sitea-size">-</span>
                            <span class="stat-label">Site_A 總容量</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                <polyline points="17 6 23 6 23 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="avg-growth">-</span>
                            <span class="stat-label">每月總產量</span>
                        </div>
                    </div>
                </section>

                <div class="site-tabs" id="site-tabs">
                    <!-- Tabs will be generated by JavaScript -->
                </div>

                <section class="sites-grid" id="sites-grid">
                    <!-- Site cards will be generated by JavaScript -->
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>載入數據中…</p>
                    </div>
                </section>
            </div>

            <!-- Log Search View -->
            <div id="log-search-view" class="view-section" style="display: none;">
                <header class="view-header">
                    <h1>Log Search Portal</h1>
                    <p>各站點 Log 查詢系統</p>
                </header>

                <div class="site-tabs" id="log-search-tabs">
                    <!-- Tabs generated by JS -->
                </div>

                <div class="log-search-container" id="log-search-grid">
                    <!-- Groups generated by JS -->
                </div>
            </div>

            <!-- Detail Modal -->
            <div class="modal" id="detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                <button class="modal-overlay" onclick="closeModal()" aria-label="Close modal"></button>
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modal-title">伺服器詳情</h2>
                        <button class="modal-close" onclick="closeModal()" aria-label="Close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="chart-container">
                            <canvas id="history-chart"></canvas>
                        </div>
                        <div class="modal-stats" id="modal-stats">
                            <!-- Stats will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>

</html>